# HTTPS와 SSL

 <br>

## HTTP vs HTTPS

HTTP는 Hypertext인 HTML을 전송하기 위한 통신 규약을 의미한다.

<br>

- HTTPS 또한 Hypertext를 통신하기 위한 규약이지만 암호화되지 않은 통신 규약인 HTTP의 보안을 지키기 위해 S(Over Secure Socket layer)를 추가한 것이라고 볼 수 있다.

<br>

## HTTPS와 SSL

SSL(TLS) 프로토콜 위에서 돌아가는 HTTP를 HTTPS라고 한다.

<br>

## SSL과 TLS

SSL이 먼저 발명이 되었고, 이것이 많이 사용되게 되면서 표준화 기구인 IETF로 이관되면서 TLS라는 이름으로 바뀌게 되었다.

즉, TLS가 현재 공식적인 명칭이지만 역사적으로 SSL이라는 명칭을 많이 사용하여서 현재까지 SSL이라는 용어를 더 많이 사용한다.

<br>

## SSL 디지털 인증서

클라이언트와 서버간의 통신을 제3자가 보증해주는 전자화된 문서이다. 클라이언트가 서버에 접속한 직후에 서버는 클라이언트에게 인증서 정보를 전달한다. 

- 장점
  - 통신내용이 공격자에게 노출되는 것을 막을 수 있다.
  - 클라이언트가 접속하려는 서버가 신뢰할 수 있는 서버인지를 판단할 수 있다.
  - 통신 내용의 악의적인 변경을 방지할 수 있다.

<br>

## SSL 암호화와 복호화

> 대칭키
>
> 공개키

### 대칭키

동일한 키로 암호화와 복호화를 같이 할 수 있는 방식의 암호화 기법을 의미한다.

- 단점 : 암호를 주고 받는 사람들 사이에 대칭키를 전달하는 것이 어렵다. 대칭키가 유출되면 공격자 또한 복호화할 수 있기때문에 무용지물..

<br>

### 공개키

두개의 키를 갖게된다.

A키로 암호화 하면 B라는 키로 복호화할 수 있고, B키로 암호화하면 A키로 복호화 할 수 있다.

- 단점 : 복호화하는데 많은 연산이 필요하다.

<br>

## SSL 인증서

인증서의 기능은 크게 두가지다.

1. 클라이언트가 접속한 서버가 신뢰 할 수 있는 서버임을 보장한다.
2. SSL 통신에 사용할 공개키를 클라이언트에게 제공한다.

<br>

### CA

인증서의 역할은 클라리언트가 접속한 서버가 클라이언트가 의도한 서버가 맞는지를 보장하는 역할을 한다. 이 역할을 하는 민간기업들이 있는데 이런 기업들을 CA라고 부른다.

<br>

## SSL의 동작방법

SSL은 암호화된 데이터를 전송하기 위해 **공개키와 대칭키를 혼합해서 사용한다.** 즉, 클라이언트와 서버가 주고 받는 실제 데이터는 **대칭키** 방식으로 암호화하고, 대칭키 방식을 암호화된 실제 정보를 복호화 할때 사용할 대칭키는 공개키 방식으로 암호화해서 클라이언트와 서버가 주고 받는다. (효율 증진)

- 실제 데이터 : 대칭키
- 대칭키의 키 : 공개키

<br>

1. 클라이언트가 서버에 접속한다. 이 단계를 `Client Hello`라고 한다. 이 단계에서 주고 받는 정보는 아래와 같다.

   - 클라이언트 측에서 생성한 랜덤 데이터

   - 클라이언트가 지원하는 암호화 방식들 : 클라이언트와 서버가 지원하는 암호화 방식이 서로 다를 수 있기 때문에 상호간에 어떤 암호화 방식을 사용할 것인지에 대한 협상을 해야 한다. 이 협상을 위해서 클라이언트 측에서는 자신이 사용할 수 있는 암호화 방식을 전송한다.

   - 세션 아이디 : 이미 SSL 핸드쉐이킹을 했다면 비용과 시간을 절약하기 위해서 기존의 세션을 재활용하게 되는데 이 때 사용할 연결에 대한 식별자를 서버 측으로 전송한다.

2. 서버는 Client Hello에 대한 응답으로 `Server Hello`를 하게 된다. 이 단계에서 주고 받는 정보는 아래와 같다.

   - 서버 측에서 생성한 랜덤 데이터
   - 서버가 선택한 클라이언트의 암호화 방식 : 클라이언트가 전달한 암호화 방식 중에서 서버 쪽에서도 사용할 수 있는 암호화 방식을 선택해서 클라이언트로 전달한다. 이로써 암호화 방식에 대한 협상이 종료되고 서버와 클라이언트는 이 암호화 방식을 이용해서 정보를 교환하게 된다.
   - **인증서**

3. 클라이언트는 서버의 인증서가 CA에 의해서 발급된 것인지를 확인하기 위해서 클라이언트에 내장된 CA 리스트를 확인한다. CA 리스트에 인증서가 없다면 사용자에게 경고 메시지를 출력한다. **인증서가 CA에 의해서 발급된 것인지를 확인하기 위해서 클라이언트에 내장된 CA의 공개키를 이용해서 인증서를 복호화한다. 복호화에 성공했다면 인증서는 CA의 개인키로 암호화된 문서임이 암시적으로 보증된 것이다.** 인증서를 전송한 서버를 믿을 수 있게 된 것이다.

4. 클라이언트는 서버의 랜덤 데이터와 자신이 생성한 랜덤 데이터를 조합해 **대칭키**를 생성한다. 대칭키를 전달할 때 공개키를 통해서 암호화하여 보내면 서버의 비밀키를 이용해서 복호화 할 수 있다.

